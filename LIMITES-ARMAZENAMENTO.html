<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limites de Armazenamento - Sistema ALUBRAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <h2>üíæ Limites de Armazenamento - Sistema ALUBRAS</h2>
                
                <div class="alert alert-info">
                    <h5>üìä An√°lise de Capacidade</h5>
                    <p>Seu sistema possui <strong>dupla prote√ß√£o</strong> contra perda de dados!</p>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5>üíæ LocalStorage (Navegador)</h5>
                            </div>
                            <div class="card-body">
                                <div id="stats-local"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5>üî• Firebase (Nuvem)</h5>
                            </div>
                            <div class="card-body">
                                <div id="stats-firebase"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5>üõ°Ô∏è Prote√ß√µes Contra Perda de Dados</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>‚úÖ Prote√ß√µes Locais:</h6>
                                <ul>
                                    <li>Salvamento autom√°tico em localStorage</li>
                                    <li>Backup antes de cada opera√ß√£o</li>
                                    <li>Valida√ß√£o de dados antes de salvar</li>
                                    <li>Recupera√ß√£o em caso de falha</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>‚úÖ Prote√ß√µes na Nuvem:</h6>
                                <ul>
                                    <li>Firebase com redund√¢ncia autom√°tica</li>
                                    <li>M√∫ltiplos servidores Google</li>
                                    <li>Backup autom√°tico di√°rio</li>
                                    <li>Sincroniza√ß√£o em tempo real</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5>üìà Capacidade Estimada</h5>
                    </div>
                    <div class="card-body">
                        <div id="capacidade-estimada"></div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <h6>‚ö†Ô∏è Quando Voc√™ Pode Perder Dados:</h6>
                    <ul>
                        <li><strong>Raramente:</strong> Limpeza completa do navegador + logout do Firebase</li>
                        <li><strong>Solu√ß√£o:</strong> Sistema sempre mant√©m backup local mesmo offline</li>
                        <li><strong>Preven√ß√£o:</strong> Fazer login periodicamente para sincronizar</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="testar-limites.js"></script>
    <script>
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getStorageSize() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length + key.length;
                }
            }
            return total;
        }

        function countRecords() {
            const prefix = 'sistema_esquadrias_';
            const tipos = ['obras', 'esquadrias', 'materiais', 'manutencoes', 'entregas'];
            let total = 0;
            
            tipos.forEach(tipo => {
                const data = localStorage.getItem(prefix + tipo);
                if (data) {
                    total += JSON.parse(data).length;
                }
            });
            
            return total;
        }

        function updateStats() {
            const tamanhoAtual = getStorageSize();
            const registrosAtuais = countRecords();
            
            // LocalStorage stats
            document.getElementById('stats-local').innerHTML = `
                <p><strong>Espa√ßo usado:</strong> ${formatBytes(tamanhoAtual)}</p>
                <p><strong>Limite total:</strong> ~5-10MB</p>
                <p><strong>Registros atuais:</strong> ${registrosAtuais}</p>
                <p><strong>Espa√ßo restante:</strong> ${formatBytes(10 * 1024 * 1024 - tamanhoAtual)}</p>
            `;

            // Firebase stats
            document.getElementById('stats-firebase').innerHTML = `
                <p><strong>Limite gratuito:</strong> 1GB + 50k leituras/dia</p>
                <p><strong>Capacidade:</strong> Milh√µes de registros</p>
                <p><strong>Backup:</strong> Autom√°tico</p>
                <p><strong>Status:</strong> ${window.firebase ? '‚úÖ Conectado' : '‚ö†Ô∏è Offline'}</p>
            `;

            // Capacidade estimada
            const tamanhoRegistro = 500; // bytes m√©dio
            const limiteMB = 5;
            const registrosPossiveis = Math.floor((limiteMB * 1024 * 1024) / tamanhoRegistro);
            
            document.getElementById('capacidade-estimada').innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <h6>üìä Capacidade Total:</h6>
                        <p><strong>~${registrosPossiveis.toLocaleString()} registros</strong></p>
                        <small class="text-muted">Considerando 5MB de limite</small>
                    </div>
                    <div class="col-md-4">
                        <h6>üìù Registros Atuais:</h6>
                        <p><strong>${registrosAtuais} itens</strong></p>
                        <small class="text-muted">Voc√™ usou: ${((registrosAtuais / registrosPossiveis) * 100).toFixed(2)}%</small>
                    </div>
                    <div class="col-md-4">
                        <h6>üî¢ Restante:</h6>
                        <p><strong>~${(registrosPossiveis - registrosAtuais).toLocaleString()} registros</strong></p>
                        <small class="text-muted">Espa√ßo para mais dados</small>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', updateStats);
    </script>
</body>
</html>
